!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=50)}([function(e,t){e.exports=React},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){var r=n(23),a=n(1);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(24);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(2);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){r(e,t,n[t])})}return e}},function(e,t,n){e.exports=n(28)},function(e,t){e.exports=ReactRouterDOM},function(e,t,n){"use strict";function r(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,n=[],r=0;r<36;r++)n[r]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return n[14]="4",n[19]="0123456789abcdef".substr(3&n[19]|8,1),n[8]=n[13]=n[18]=n[23]=e,n.join("").substr(0,t)}function a(e,t){return!t||new RegExp(t,"i").test(e)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a})},function(e,t){function n(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var i=e.apply(t,r);function c(e){n(i,a,o,c,u,"next",e)}function u(e){n(i,a,o,c,u,"throw",e)}c(void 0)})}}},function(e,t,n){var r=n(39),a=n(40),o=n(41);e.exports=function(e){return r(e)||a(e)||o()}},function(e,t){e.exports=d3},function(e,t){e.exports=ReactDOM},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CLOCK}),__webpack_require__.d(__webpack_exports__,"b",function(){return Cell});var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8),_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_4__),lib_common__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11),CLOCK=Symbol("系统时钟"),Cell=function(){function Cell(e){_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3___default()(this,Cell),this.clock=0,e.from?this.initByFullConfig(e):this.initBySimpleConfig(e)}return _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_4___default()(Cell,null,[{key:"assignInfo",value:function(e,t){e.type=t.type,e.name=t.name,e.desc=t.desc,e.x=t.x,e.y=t.y}}]),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_4___default()(Cell,[{key:"initByFullConfig",value:function(e){var t=e.components[e.from];this.id=t.id||Object(lib_common__WEBPACK_IMPORTED_MODULE_5__.b)(),this.input=t.input||[],this.out=t.output,this.component=t.component,Cell.assignInfo(this,t),this.body=t.links.map(function(t){var n=e.components[t.component];if("COMPONENT"===n.type){var r=n.input.reduce(function(e,n,r){return e[n]=t.input[r],e},{});return new Cell({components:_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},e.components,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()({},t.component,_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},n,t,{links:n.links.map(function(e){return _babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},e,{input:e.input.map(function(e,t){return r[e]||e})})})}))),from:t.component})}return new Cell(_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},t,n))})}},{key:"initBySimpleConfig",value:function initBySimpleConfig(config){this.id=config.id||Object(lib_common__WEBPACK_IMPORTED_MODULE_5__.b)(),this.input=config.input||[],this.component=config.component,Cell.assignInfo(this,config),eval("this.body = ".concat(config.body))}},{key:"reset",value:function(){this.clock=0,this.lastData=void 0,this.innerClock=void 0,"COMPONENT"===this.type&&this.body.map(function(e){return e.reset()})}},{key:"setFunc",value:function setFunc(func){eval("this.body = ".concat(func))}},{key:"addInput",value:function(e){this.input.push(e)}},{key:"removeInput",value:function(e){this.input.splice(e,1)}},{key:"toJson",value:function(){var e={};return this.getComponents(e),{from:this.id,components:e}}},{key:"collapse",value:function(e){var t,n=this,r=this.toJson(),a=r.components[r.from],o=this.body.find(function(e){return e.id===n.out}),i=Object(lib_common__WEBPACK_IMPORTED_MODULE_5__.b)(),c={from:i,components:_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},r.components,(t={},_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()(t,r.from,_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default()({},a,{output:this.out,name:e.name,desc:e.desc})),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()(t,i,{type:"COMPONENT",name:this.name,desc:this.desc,input:[],links:[{id:Object(lib_common__WEBPACK_IMPORTED_MODULE_5__.b)(),input:[],component:r.from,x:o.x,y:o.y}]}),t))};return this.initByFullConfig(c),c}},{key:"getComponents",value:function(e){(e=e||{})[this.component||this.id]||("COMPONENT"===this.type?(e[this.component||this.id]={input:this.input,output:this.out,type:this.type,name:this.name,desc:this.desc,links:this.body.map(function(e){return{id:e.id,input:e.input,component:e.component,x:e.x,y:e.y}})},this.body.map(function(t){t.getComponents(e)})):e[this.component]={type:this.type,name:this.name,desc:this.desc,body:this.body&&this.body.toString()})}},{key:"calc",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=this.body.find(function(t){return t.id===e});if(!o)return r[this.input.findIndex(function(t){return t===e})];if(o.innerClock>=window[CLOCK])return o.lastData;o.innerClock=window[CLOCK];var i=o.input.map(function(e){return t.calc.apply(t,[e].concat(r))});return o.output.apply(o,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(i))}},{key:"output",value:function(){if(this.clock>=window[CLOCK])return this.lastData;this.clock++;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("COMPONENT"===this.type)return this.lastData=this.calc.apply(this,[this.out].concat(t)),this.lastData;if("VIEW"===this.type)return[this.clock].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(t.map(function(e){return e.lastData})));var r=this.body.bind({clock:window[CLOCK]});return this.lastData=r.apply(void 0,t),this.lastData}}]),Cell}()},function(e,t,n){var r=n(25),a=n(26),o=n(27);e.exports=function(e,t){return r(e)||a(e,t)||o()}},function(e,t,n){var r=n(35);e.exports=function(e,t){if(null==e)return{};var n,a,o=r(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}},function(e,t){e.exports=antd},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),a=Object.prototype.hasOwnProperty,o=Array.prototype.splice,i=Object.prototype.toString;function c(e){return i.call(e).slice(8,-1)}var u=Object.assign||function(e,t){return l(t).forEach(function(n){a.call(t,n)&&(e[n]=t[n])}),e},l="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function s(e){return Array.isArray(e)?u(e.constructor(e.length),e):"Map"===c(e)?new Map(e):"Set"===c(e)?new Set(e):e&&"object"==typeof e?u(Object.create(Object.getPrototypeOf(e)),e):e}var p=function(){function e(){this.commands=u({},f),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,o="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(o)||r(!Array.isArray(o),"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."),r("object"==typeof o&&null!==o,"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: %s.",Object.keys(this.commands).join(", "));var i=e;return l(o).forEach(function(t){if(a.call(n.commands,t)){var r=e===i;i=n.commands[t](o[t],i,o,e),r&&n.isEquals(i,e)&&(i=e)}else{var u="Map"===c(e)?n.update(e.get(t),o[t]):n.update(e[t],o[t]),l="Map"===c(i)?i.get(t):i[t];n.isEquals(u,l)&&(void 0!==u||a.call(e,t))||(i===e&&(i=s(e)),"Map"===c(i)?i.set(t,u):i[t]=u)}}),i},e}();t.Context=p;var f={$push:function(e,t,n){return d(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return d(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,a){return function(e,t){r(Array.isArray(e),"Expected $splice target to be an array; got %s",e),_(t.$splice)}(t,n),e.forEach(function(e){_(e),t===a&&e.length&&(t=s(a)),o.apply(t,e)}),t},$set:function(e,t,n){return function(e){r(1===Object.keys(e).length,"Cannot have more than one key in an object with $set")}(n),e},$toggle:function(e,t){m(e,"$toggle");var n=e.length?s(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},$unset:function(e,t,n,r){return m(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===r&&(t=s(r)),delete t[e])}),t},$add:function(e,t,n,r){return y(t,"$add"),m(e,"$add"),"Map"===c(t)?e.forEach(function(e){var n=e[0],a=e[1];t===r&&t.get(n)!==a&&(t=s(r)),t.set(n,a)}):e.forEach(function(e){t!==r||t.has(e)||(t=s(r)),t.add(e)}),t},$remove:function(e,t,n,r){return y(t,"$remove"),m(e,"$remove"),e.forEach(function(e){t===r&&t.has(e)&&(t=s(r)),t.delete(e)}),t},$merge:function(e,t,n,a){var o,i;return o=t,r((i=e)&&"object"==typeof i,"update(): $merge expects a spec of type 'object'; got %s",i),r(o&&"object"==typeof o,"update(): $merge expects a target of type 'object'; got %s",o),l(e).forEach(function(n){e[n]!==t[n]&&(t===a&&(t=s(a)),t[n]=e[n])}),t},$apply:function(e,t){var n;return r("function"==typeof(n=e),"update(): expected spec of $apply to be a function; got %s.",n),e(t)}},h=new p;function d(e,t,n){r(Array.isArray(e),"update(): expected target of %s to be an array; got %s.",n,e),m(t[n],n)}function m(e,t){r(Array.isArray(e),"update(): expected spec of %s to be an array; got %s. Did you forget to wrap your parameter in an array?",t,e)}function _(e){r(Array.isArray(e),"update(): expected spec of $splice to be an array of arrays; got %s. Did you forget to wrap your parameters in an array?",e)}function y(e,t){var n=c(e);r("Map"===n||"Set"===n,"update(): %s expects a target of type Set or Map; got %s",t,n)}t.isEquals=h.update.isEquals,t.extend=h.extend,t.default=h.update,t.default.default=e.exports=u(t.default,t)},function(e){e.exports={SUM:"function(...args) {\n\treturn args.reduce((p, n) => p + n, 0);\n}",MAX:"function(...args) {\n\treturn Math.max(...args);\n}",MIN:"function(...args) {\n\treturn Math.min(...args);\n}",MULT:"function(...args) {\n\treturn args.reduce((p, n) => p * n, 1);\n}",SIN:"function(step = 1) {\n\treturn Math.sin(this.clock * Math.PI / 180 * step);\n}",COS:"function(step = 1) {\n\treturn Math.cos(this.clock * Math.PI / 180 * step);\n}",TICK:"function() {\n\treturn this.clock;\n}",RAND:"function() {\n\treturn Math.random()}"}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=a&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(29),a)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,r=Object.prototype,a=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",l="object"==typeof e,s=t.regeneratorRuntime;if(s)l&&(e.exports=s);else{(s=t.regeneratorRuntime=l?e.exports:{}).wrap=E;var p="suspendedStart",f="suspendedYield",h="executing",d="completed",m={},_={};_[i]=function(){return this};var y=Object.getPrototypeOf,v=y&&y(y(j([])));v&&v!==r&&a.call(v,i)&&(_=v);var b=C.prototype=x.prototype=Object.create(_);O.prototype=b.constructor=C,C.constructor=O,C[u]=O.displayName="GeneratorFunction",s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===O||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(b),e},s.awrap=function(e){return{__await:e}},k(w.prototype),w.prototype[c]=function(){return this},s.AsyncIterator=w,s.async=function(e,t,n,r){var a=new w(E(e,t,n,r));return s.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},k(b),b[u]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},s.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},s.values=j,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,a){return c.type="throw",c.arg=e,t.next=r,a&&(t.method="next",t.arg=n),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;M(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function E(e,t,n,r){var a=t&&t.prototype instanceof x?t:x,o=Object.create(a.prototype),i=new N(r||[]);return o._invoke=function(e,t,n){var r=p;return function(a,o){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===a)throw o;return L()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=P(i,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=g(e,t,n);if("normal"===u.type){if(r=n.done?d:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,i),o}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function O(){}function C(){}function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function w(e){var t;this._invoke=function(n,r){function o(){return new Promise(function(t,o){!function t(n,r,o,i){var c=g(e[n],e,r);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&a.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,o,i)},function(e){t("throw",e,o,i)}):Promise.resolve(l).then(function(e){u.value=e,o(u)},function(e){return t("throw",e,o,i)})}i(c.arg)}(n,r,t,o)})}return t=t?t.then(o,o):o()}}function P(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,P(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=g(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,m;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(a.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:L}}function L(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";e.exports=function(e,t,n,r,a,o,i,c){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,a,o,i,c],s=0;(u=new Error(t.replace(/%s/g,function(){return l[s++]}))).name="Invariant Violation"}throw u.framesToPop=1,u}}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"project",function(){return j}),n.d(r,"component",function(){return L});var a=n(4),o=n.n(a),i=n(3),c=n.n(i),u=n(5),l=n.n(u),s=n(6),p=n.n(s),f=n(7),h=n.n(f),d=n(0),m=n.n(d),_=n(15),y=n.n(_),v=n(10),b=n(18),E=n.n(b),g=n(9),x=n.n(g),O=n(8),C=n.n(O),k=n(12),w=n.n(k),P=n(11),D=n(21),M=n.n(D),N=function(){function e(t){o()(this,e),this.table=t;var n=localStorage[t];n||(localStorage[t]=JSON.stringify([]),n=localStorage[t]),this.data=JSON.parse(n)}return c()(e,[{key:"add",value:function(){var e=w()(x.a.mark(function e(t){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=C()({},t,{_id:t._id||Object(P.b)()}),this.data.push(t),localStorage[this.table]=JSON.stringify(this.data),e.abrupt("return",t._id);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=w()(x.a.mark(function e(t){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.data=this.data.filter(function(e){return e._id!==t}),localStorage[this.table]=JSON.stringify(this.data);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=w()(x.a.mark(function e(t,n){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.data=this.data.map(function(e){return Object.entries(t).every(function(t){var n=E()(t,2),r=n[0],a=n[1];return e[r]===a})?M()(e,n):e}),localStorage[this.table]=JSON.stringify(this.data);case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=w()(x.a.mark(function e(t){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",this.data.filter(function(e){return Object.entries(t).every(function(t){var n=E()(t,2),r=n[0],a=n[1];return e[r]===a})}));case 2:return e.abrupt("return",this.data);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findOne",value:function(){var e=w()(x.a.mark(function e(t){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t).then(function(e){return e[0]});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),j=new N("project"),L=new N("component"),A=(n(31),function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){return m.a.createElement("div",{className:"home"},m.a.createElement("h2",null,"INFINITY"),m.a.createElement("p",null,"这是一个编辑器"),m.a.createElement("p",null,m.a.createElement(v.NavLink,{to:"/project"},"开始 >")))}}]),t}(d.Component)),S=n(1),I=n.n(S),T=n(2),R=n.n(T),B=n(20),U=(n(32),function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){var e=this.props,t=e.ratio,n=e.children;return m.a.createElement("div",{className:"card"},m.a.createElement("div",{className:"bg",style:{paddingBottom:"".concat(100*t,"%")}}," "),m.a.createElement("div",{className:"container"},n))}}]),t}(d.Component));R()(U,"defaultProps",{ratio:.618});var K=n(16),W=n.n(K),$=(n(33),function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){var e=W()({},this.props);return"textarea"===e.type?m.a.createElement("textarea",W()({rows:"3"},e,{className:"infinity-input infinity-focus ".concat(e.className||"")})):m.a.createElement("input",W()({autocomplete:"off"},e,{className:"infinity-input infinity-focus ".concat(e.className||"")}))}}]),t}(d.Component)),q=(n(34),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"handleChange",function(e,t){n.data[t]=e.target.value,n.invalid[t]!==!e.target.checkValidity()&&(n.invalid[t]=!e.target.checkValidity(),n.forceUpdate()),n.props.onChange&&n.props.onChange(n.data,n.invalid)}),n.data={},n.invalid={},m.a.Children.map(e.children,function(e){e.props.name&&(n.data[e.props.name]=void 0!==e.value?e.value:e.defaultValue)}),n}return h()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=this.props.children;return m.a.createElement("form",null,m.a.Children.map(t,function(t){var n=t.props,r=n.name,a=n.className;return C()({},t,{props:C()({},t.props,{className:e.invalid[r]?"infinity-err ".concat(a):a,onChange:function(t){e.handleChange(t,r)}})})}))}}]),t}(d.Component)),F=n(19),V=n.n(F),Y=(n(36),function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=V()(e,["children"]);return m.a.createElement("button",W()({},n,{className:"infinity-btn infinity-hover ".concat(n.className||"")}),t)}}]),t}(d.Component)),J=(n(37),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"handleCancel",function(){n.props.onCancel&&n.props.onCancel()}),R()(I()(I()(n)),"handleOk",function(){n.props.onOk&&n.props.onOk()}),R()(I()(I()(n)),"clearEvent",function(e){e.preventDefault(),e.stopPropagation()}),n}return h()(t,e),c()(t,null,[{key:"open",value:function(e){var n=document.createElement("div");function r(){document.getElementById("app").style.filter="none",y.a.unmountComponentAtNode(n)&&n.parentNode&&(e.onCancel&&e.onCancel.apply(e,arguments),n.parentNode.removeChild(n))}document.body.appendChild(n),document.getElementById("app").style.filter="blur(10px)";var a=e.content,o=V()(e,["content"]);return y.a.render(m.a.createElement(t,W()({},o,{onCancel:r}),a),n),{close:r}}}]),c()(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.width,r=e.height,a=e.title,o=e.className;return m.a.createElement("div",{className:"modal ".concat(o||""),onClick:this.handleCancel},m.a.createElement("div",{className:"modal-container",onClick:this.clearEvent,style:{width:n,height:r}},m.a.createElement("div",{className:"modal-header"},m.a.createElement("h2",{className:"modal-title"},a),m.a.createElement("a",{className:"modal-close infinity-hover",onClick:this.handleCancel},m.a.createElement("i",{className:"iconfont icon-delete"}))),m.a.createElement("div",{className:"modal-content"},t),m.a.createElement("div",{className:"modal-footer"},m.a.createElement(Y,{onClick:this.handleOk},"确定"),m.a.createElement(Y,{onClick:this.handleCancel},"取消"))))}}]),t}(d.Component));function X(e){var t=this;return J.open(C()({},e,{content:React.createElement(q,{onChange:function(e,n){t.data=e,t.invalid=n}},e.content),onOk:function(){Object.values(t.invalid).find(function(e){return e})||e.onOk&&e.onOk(t.data)}}))}function G(e){var t=J.open(C()({},e,{onOk:function(){e.onOk&&e.onOk(),t.close()}}))}R()(J,"defaultProps",{title:"Modal",width:320});n(38);var H=function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"update",function(){API.project.find().then(function(e){n.setState({projects:e})})}),R()(I()(I()(n)),"handleCreateModal",function(){n.modalCreate=new X({title:"创建项目",content:[m.a.createElement($,{name:"name",required:!0,placeholder:"名称",style:{marginBottom:15}}),m.a.createElement($,{name:"desc",type:"textarea",placeholder:"简介"})],onOk:function(e){n.create(e)}})}),R()(I()(I()(n)),"create",function(){var e=w()(x.a.mark(function e(t){var r,a,o,i;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(P.b)(),e.next=3,API.project.add({name:t.name,desc:t.desc,config:{from:r,components:R()({},r,{type:"COMPONENT",name:t.name,desc:t.desc,input:[],links:[]})}});case 3:a=e.sent,o=n.props,i=o.match,o.history.push("".concat(i.path,"/").concat(a)),n.modalCreate.close(),n.modalCreate=null;case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),R()(I()(I()(n)),"handleRemove",function(e){var t=n.state.projects.find(function(t){return t._id===e});G({title:"删除项目",content:'确定删除"'.concat(t.name,'"吗?'),onOk:function(){API.project.remove(e).then(function(){n.setState({projects:n.state.projects.filter(function(t){return t._id!==e})})})}})}),R()(I()(I()(n)),"handleSearch",function(e){n.setState({query:e.target.value})}),n.state={projects:[],query:""},n}return h()(t,e),c()(t,[{key:"componentDidMount",value:function(){this.update()}},{key:"render",value:function(){var e=this,t=this.props.match,n=this.state,r=n.projects,a=n.query;return m.a.createElement("div",{className:"project-list"},m.a.createElement("div",{className:"search-bar"},m.a.createElement("input",{onChange:this.handleSearch,type:"text",placeholder:"请输入要搜索的内容"}),m.a.createElement("a",{className:"search-btn"},m.a.createElement("i",{className:"iconfont icon-search"}))),m.a.createElement(B.Row,{gutter:16},m.a.createElement(B.Col,{xs:12,sm:8,md:6,lg:6,xl:4},m.a.createElement(U,null,m.a.createElement("a",{className:"project-list-item",onClick:this.handleCreateModal},m.a.createElement("i",{className:"iconfont icon-new"})))),r.filter(function(e){return Object(P.a)(e.name,a)}).map(function(n,r){return m.a.createElement(B.Col,{key:n._id,xs:12,sm:8,md:6,lg:6,xl:4},m.a.createElement(U,null,m.a.createElement(v.NavLink,{className:"project-list-item",to:"".concat(t.path,"/").concat(n._id)},m.a.createElement("i",{className:"iconfont icon-component"}),m.a.createElement("div",{className:"info"},m.a.createElement("h2",null,n.name),m.a.createElement("p",null,n.desc))),m.a.createElement("a",{className:"delete",onClick:function(){return e.handleRemove(n._id)}},m.a.createElement("i",{className:"iconfont icon-delete"}))))})))}}]),t}(d.Component),z=n(13),Q=n.n(z),Z=(n(42),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"handleClick",function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];e&&e.apply(void 0,r),n.props.onBlur()}),n}return h()(t,e),c()(t,[{key:"componentDidMount",value:function(){this.refs.menu.focus()}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.onBlur;return m.a.createElement("div",{className:"context-menu"},m.a.createElement("ul",{tabindex:"1",ref:"menu",onBlur:r},n.map(function(t,n){return m.a.createElement("li",{key:n,onClick:function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e.handleClick.apply(e,[t.onClick].concat(r))}},t.name)})))}}]),t}(d.Component)),ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){return C()({},n,{props:C()({},n.props,{onDragEnter:function(e){e.preventDefault()},onDragOver:function(e){e.preventDefault()},onDrop:function(n){n.preventDefault();var r=function(e){return JSON.parse(e.dataTransfer.getData("text"))}(n);-1!==e.indexOf(r.type)&&t.onDrop&&t.onDrop(r,n)}})})}},te=function(e,t){return function(n){return C()({},n,{props:C()({},n.props,{draggable:!0,onDragStart:function(n){n.dataTransfer.setData("text",JSON.stringify({type:e,data:t}))}})})}},ne=n(17),re=(n(43),function(e){function t(e){var n;return o()(this,t),(n=l()(this,p()(t).call(this,e))).rect={x:e.x,y:e.y},n}return h()(t,e),c()(t,[{key:"render",value:function(){var e=this.props.children,t=this.rect,n=t.x,r=t.y;return m.a.createElement("div",{className:"popover",style:{left:n,top:r}},e)}}]),t}(d.Component));R()(re,"defaultProps",{x:0,y:0});var ae=function(e){var t=document.createElement("div");function n(){y.a.unmountComponentAtNode(t)&&t.parentNode&&t.parentNode.removeChild(t),e.onCancel&&e.onCancel.apply(e,arguments)}document.body.appendChild(t);var r=C()({},e.content,{props:C()({},e.content.props,{onBlur:n})});return y.a.render(m.a.createElement(re,{x:e.x,y:e.y},r),t),{destroy:n}},oe=(n(44),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"mount",function(e){n.editor=ace.edit(e),n.editor.setTheme("ace/theme/monokai"),n.editor.session.setMode("ace/mode/javascript")}),R()(I()(I()(n)),"getValue",function(){return n.editor.getValue()}),n}return h()(t,e),c()(t,[{key:"render",value:function(){return m.a.createElement("div",{className:"editor",onClick:function(e){e.stopPropagation(),e.preventDefault()}},m.a.createElement("div",{ref:this.mount,style:{width:"100%",height:"100%"}},this.props.children))}}]),t}(d.Component)),ie=n(22),ce=n(14),ue=(n(45),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"customXAxis",function(e){e.call(n.xAxis),e.selectAll(".tick line").attr("stroke","#777").attr("stroke-dasharray","2,2"),e.selectAll(".tick text").attr("dy",-10).attr("dx",8)}),R()(I()(I()(n)),"customYAxis",function(e){e.call(n.yAxis),e.selectAll(".tick line").attr("stroke","#777").attr("stroke-dasharray","2,2"),e.selectAll(".tick text").attr("x",4).attr("dy",-4)}),n}return h()(t,e),c()(t,[{key:"componentDidMount",value:function(){var e=this.props.data,t=this.refs.container,n=t.clientWidth,r=t.clientHeight;this.svg=ce.select(this.refs.svg),this.x=ce.scaleLinear().range([0,n]),this.y=ce.scaleLinear().range([r,0]),this.xAxis=ce.axisBottom(this.x).tickSize(r),this.yAxis=ce.axisRight(this.y).tickSize(n).ticks(5),this.update(e),this.svg.append("g").attr("class","axis axis-x").attr("transform","translate(0, 0)").call(this.customXAxis),this.svg.append("g").attr("class","axis axis-y").call(this.customYAxis)}},{key:"componentWillReceiveProps",value:function(e){e.data!==this.props.data&&this.update(e.data)}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.props.xCount,r=void 0===n?30:n;t=t.length<r?[].concat(Q()(t),Q()(Array(r-t.length).fill(0).map(function(e,n){return[n+t.length,0]}))):t.slice(-r-1),this.x.domain(ce.extent(t,function(e){return e[0]}));var a=ce.extent(t,function(e){return e[1]}),o=.1*(a[1]-a[0]);a=[a[0]-o,a[1]+o],this.y.domain(a),this.line=ce.line().x(function(t){return e.x(t[0])}).y(function(t){return e.y(t[1])}),this.g&&this.g.remove(),this.g=this.svg.append("g"),this.g.append("path").datum(t).attr("class","line").attr("d",this.line),this.svg.select(".axis-x").call(this.customXAxis),this.svg.select(".axis-y").call(this.customYAxis)}},{key:"render",value:function(){return m.a.createElement("div",{className:"osc",ref:"container"},m.a.createElement("svg",{ref:"svg"}))}}]),t}(d.Component)),le=function(){function e(t){var n=this,r=t.dom,a=t.onDrag,i=t.onDragEnd;o()(this,e),R()(this,"dragStart",function(e){n.lx=e.pageX,n.ly=e.pageY,window.addEventListener("mousemove",n.drag),window.addEventListener("mouseup",n.dragEnd)}),R()(this,"dragEnd",function(e){window.removeEventListener("mousemove",n.drag),window.removeEventListener("mouseup",n.dragEnd),n.cb(e,n.onDragEnd)}),R()(this,"drag",function(e){n.cb(e,n.onDrag)}),this.onDrag=a,this.onDragEnd=i,r.addEventListener("mousedown",this.dragStart)}return c()(e,[{key:"cb",value:function(e,t){if(t){var n=e.pageX-this.lx,r=e.pageY-this.ly;this.lx=e.pageX,this.ly=e.pageY,t(n,r)}}}]),e}(),se=(n(46),function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"componentDidMount",value:function(){var e=this;new le({dom:this.dragHandler,onDrag:function(t,n){e.props.onDrag&&e.props.onDrag(t,n)},onDragEnd:function(t,n){e.props.onDragEnd&&e.props.onDragEnd(t,n)}})}},{key:"render",value:function(){var e=this,t=this.props,n=t.module,r=t.onLink,a=t.onEdit,o=t.onContextMenu;return m.a.createElement("g",{className:"brick",transform:"translate(".concat(n.x-25,", ").concat(n.y-25,")")},m.a.createElement("g",{ref:function(t){return e.dragHandler=t},onContextMenu:o},m.a.createElement("rect",{width:50,height:50}),m.a.createElement("text",{x:25,y:25,onDoubleClick:a},n.name),m.a.createElement("text",{className:"output",x:62,y:37},n.lastData&&n.lastData.toFixed(2))),m.a.createElement("g",{className:"io-area",onClick:function(){return r&&r(n)}},m.a.createElement("rect",{x:0,y:0,width:50,height:5}),m.a.createElement("rect",{x:45,y:0,width:5,height:50}),m.a.createElement("rect",{x:0,y:45,width:50,height:5}),m.a.createElement("rect",{x:0,y:0,width:5,height:50})))}}]),t}(d.Component)),pe=(n(47),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"handleLink",function(e){n.currentInput?(n.props.onLink(e,n.currentInput),n.clearTmpLink()):"VIEW"!==e.type&&(n.currentInput=e,n.tmpPath=document.createElementNS("http://www.w3.org/2000/svg","path"),n.tmpPath.setAttribute("class","path-display"),n.refs.lines.appendChild(n.tmpPath),n.linkAnimate=function(t){var r=n.refs.svg.getBoundingClientRect();n.tmpPath.setAttribute("d",n.pathData(e,{x:t.pageX-r.x,y:t.pageY-r.y,width:0,height:0}))},n.handleKeyPress=function(e){e.stopPropagation(),e.preventDefault(),n.clearTmpLink()},window.addEventListener("mousemove",n.linkAnimate),window.addEventListener("contextmenu",n.handleKeyPress))}),R()(I()(I()(n)),"clearTmpLink",function(){n.currentInput=null,window.removeEventListener("mousemove",n.linkAnimate),window.removeEventListener("contextmenu",n.handleKeyPress),n.linkAnimate=null,n.handleKeyPress=null,n.refs.lines.removeChild(n.tmpPath),n.tmpPath=null}),n}return h()(t,e),c()(t,[{key:"pathData",value:function(e,t){var n=e.x+25+20,r=e.x-25-20,a=e.y-25-20,o=e.y+25+20,i=t.x-25-20,c=t.y-25-20,u=t.y+25+20,l="M".concat(e.x," ").concat(e.y," ");return e.x+25<t.x-25?(i=n=(n+i)/2,l+="L".concat(n," ").concat(e.y," L").concat(n," ").concat(t.y," L").concat(i," ").concat(t.y," ")):(l+="L".concat(n," ").concat(e.y," "),o<c?l+="L".concat(n," ").concat(c," L").concat(i," ").concat(c," L").concat(i," ").concat(t.y," "):a>u?l+="L".concat(n," ").concat(u," L").concat(i," ").concat(u," L").concat(i," ").concat(t.y," "):e.y>t.y?l+="L".concat(n," ").concat(Math.max(u,o)," L").concat(Math.min(i,r)," ").concat(Math.max(u,o)," L").concat(Math.min(i,r)," ").concat(t.y," "):l+="L".concat(n," ").concat(Math.min(c,a)," L").concat(Math.min(i,r)," ").concat(Math.min(c,a)," L").concat(Math.min(i,r)," ").concat(t.y," ")),l+="L".concat(t.x," ").concat(t.y)}},{key:"render",value:function(){var e=this,t=this.props,n=t.cell,r=t.onDrop,a=t.onDrag,o=t.onDragEnd,i=t.onLinkContext,c=t.onContextMenu,u=t.onEdit;return ee(["FUNCTION","COMPONENT","VIEW"],{onDrop:r})(m.a.createElement("svg",{className:"component-editor",ref:"svg"},m.a.createElement("g",{className:"lines",ref:"lines"},n.body.map(function(t){return m.a.createElement("g",{key:t.id},t.input.map(function(r,a){var o=n.body.find(function(e){return e.id===r});return m.a.createElement("g",{key:"".concat(t.id,"-").concat(r),className:"link-path",onContextMenu:function(e){return i(e,t,a)}},m.a.createElement("path",{className:"path-hidden",d:e.pathData(o,t)}),m.a.createElement("path",{className:"path-display",d:e.pathData(o,t)}))}))})),m.a.createElement("g",{className:"modules"},n.body.map(function(t){return m.a.createElement(se,{key:t.id,module:t,onDrag:function(e,n){return a(t,e,n)},onDragEnd:function(e,n){return o(t)},onLink:e.handleLink,onEdit:function(){return u(t)},onContextMenu:function(e){return c(e,t)}})}))))}}]),t}(d.Component)),fe=(n(48),function(e){function t(e){var n;return o()(this,t),n=l()(this,p()(t).call(this,e)),R()(I()(I()(n)),"init",w()(x.a.mark(function e(){var t,r,a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.match.params.id,e.next=3,API.project.findOne({_id:t});case 3:return r=e.sent,e.next=6,API.component.find();case 6:a=e.sent,n.publicComponents=a.filter(function(e){return e._id!==t}),n.project=r,n.cell=new ne.b(r.config),n.history.push(n.cell),n.forceUpdate();case 12:case"end":return e.stop()}},e,this)}))),R()(I()(I()(n)),"handleDrop",function(){var e=w()(x.a.mark(function e(t,r){var a,o,i,c,u,l;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.type,o=t.data,i=r.target.getBoundingClientRect(),c=r.pageX-i.x,u=r.pageY-i.y,"COMPONENT"!==a){e.next=10;break}return l=n.project.config.components,e.next=8,n.cell.body.push(new ne.b({components:C()({},l,R()({},o.id,C()({},l[o.id],{component:o.id,x:c,y:u}))),from:o.id}));case 8:e.next=18;break;case 10:if("FUNCTION"!==a){e.next=15;break}return e.next=13,n.cell.body.push(new ne.b({id:Object(P.b)(),input:[],component:Object(P.b)(),name:o.name||"ƒ(x)",body:o.body,type:a,x:c,y:u}));case 13:e.next=18;break;case 15:if("VIEW"!==a){e.next=18;break}return e.next=18,n.cell.body.push(new ne.b({id:Object(P.b)(),input:[],component:Object(P.b)(),name:"V(x)",type:a,x:c,y:u}));case 18:n.forceUpdate();case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()),R()(I()(I()(n)),"handleDrag",function(e,t,r){e.x+=t,e.y+=r,n.forceUpdate()}),R()(I()(I()(n)),"handleDragEnd",function(e){}),R()(I()(I()(n)),"handleLink",function(e,t){e.addInput(t.id),n.forceUpdate()}),R()(I()(I()(n)),"handleEdit",function(e){if("COMPONENT"===e.type)return n.history.push(e),n.cell=e,void n.forceUpdate();var t=new oe({children:e.body&&e.body.toString()}),r=J.open({className:"modal-editor",width:"80%",height:"80%",content:t.render(),onOk:function(){var n=t.getValue();e.setFunc(n),r.close()}})}),R()(I()(I()(n)),"handleContextMenu",function(e,t){e.stopPropagation(),e.preventDefault();ae({x:e.pageX,y:e.pageY,content:m.a.createElement(Z,{data:[{name:"编辑",onClick:function(){return n.handleEdit(t)}},{name:"设为输出",onClick:function(){return n.cell.out=t.id}},{name:"删除",onClick:function(){n.cell.body=n.cell.body.filter(function(e){if(e!==t)return e.input=e.input.filter(function(e){return e!==t.id}),!0}),n.forceUpdate()}}]})})}),R()(I()(I()(n)),"handleLinkContext",function(e,t,r){e.stopPropagation(),e.preventDefault();ae({x:e.pageX,y:e.pageY,content:m.a.createElement(Z,{data:[{name:"删除",onClick:function(){t.removeInput(r),n.forceUpdate()}}]})})}),R()(I()(I()(n)),"publish",function(){G({title:"发布项目",content:'确定发布"'.concat(n.project.name,'"吗?'),onOk:function(){API.component.add({_id:n.props.match.params.id,name:n.project.name,desc:n.project.desc,config:n.cell.toJson()})}})}),R()(I()(I()(n)),"code",function(){var e=J.open({title:"Code",width:"80%",height:"80%",content:m.a.createElement("pre",{style:{height:"100%",overflow:"auto",userSelect:"text"}},JSON.stringify(n.cell.toJson(),void 0,2)),onOk:function(){e.close()}})}),R()(I()(I()(n)),"run",function(){if(n.interval)clearInterval(n.interval),n.refs.osc.style.bottom="-200px",n.interval=null;else{window[ne.a]=0,n.cell.reset(),n.view=[];var e=n.cell.body.find(function(e){return"VIEW"===e.type}),t=[];e&&(n.refs.osc.style.bottom=0,t=e.input.map(function(e){return n.cell.body.find(function(t){return t.id===e})})),n.interval=setInterval(function(){window[ne.a]++,n.cell.output(),e&&(n.view=[].concat(Q()(n.view),[e.output.apply(e,Q()(t))])),n.forceUpdate()},localStorage.INTERVAL||1e3)}n.forceUpdate()}),R()(I()(I()(n)),"save",function(){API.project.update({_id:n.props.match.params.id},{$merge:{config:n.history[0].toJson()}})}),R()(I()(I()(n)),"handleSaveComponent",function(){n.history[0].out?n.modalSaveComponent=new X({title:"保存为组件",content:[m.a.createElement($,{name:"name",required:!0,placeholder:"名称",style:{marginBottom:15}}),m.a.createElement($,{name:"desc",type:"textarea",placeholder:"简介"})],onOk:function(e){n.saveComponent(e)}}):alert("未指定输出：右键单击组件，选择“设为输出”")}),R()(I()(I()(n)),"saveComponent",function(e){n.project.config=n.history[0].collapse(e),n.modalSaveComponent.close(),n.modalSaveComponent=null,n.forceUpdate()}),R()(I()(I()(n)),"handleHistory",function(e){n.history.splice(e+1),n.cell=n.history[e],n.forceUpdate()}),n.view=[],n.history=[],n}return h()(t,e),c()(t,[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var e=this,t=this.project,n=this.publicComponents,r=this.view;if(!t)return null;var a=Object.entries(t.config.components||{}).filter(function(e){return"COMPONENT"===e[1].type&&e[0]!==t.config.from});return m.a.createElement("div",{className:"project-detail"},m.a.createElement("nav",null,m.a.createElement("div",{className:"title"},m.a.createElement(v.NavLink,{to:"/project"},m.a.createElement("i",{className:"iconfont icon-home"})),this.history.map(function(t,n){return m.a.createElement("span",null," / ",m.a.createElement("a",{onClick:function(){return e.handleHistory(n)}},t.name))}))),m.a.createElement("div",{className:"body"},m.a.createElement("div",{className:"sidebar"},m.a.createElement("div",null,m.a.createElement("h2",null,"基础组件"),te("FUNCTION",{})(m.a.createElement("div",{className:"brick-card infinity-hover"},"ƒ(x)")),te("VIEW",{})(m.a.createElement("div",{className:"brick-card infinity-hover"},"V(x)")),Object.entries(ie).map(function(e){var t=E()(e,2),n=t[0],r=t[1];return te("FUNCTION",{name:n,body:r})(m.a.createElement("div",{key:n,className:"brick-card infinity-hover"},n))})),m.a.createElement("div",null,m.a.createElement("h2",null,"项目组件"),a.map(function(e){var t=E()(e,2),n=t[0],r=t[1];return te("COMPONENT",{id:n})(m.a.createElement("div",{className:"brick-card infinity-hover"},r.name))})),m.a.createElement("div",null,m.a.createElement("h2",null,"公共组件"),n&&n.map(function(e){return te("COMPONENT",{})(m.a.createElement("div",{className:"brick-card infinity-hover"},e.name))}))),m.a.createElement("div",{className:"content",ref:"content"},m.a.createElement(pe,{cell:this.cell,onDrop:this.handleDrop,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onLink:this.handleLink,onEdit:this.handleEdit,onLinkContext:this.handleLinkContext,onContextMenu:this.handleContextMenu}),m.a.createElement("div",{className:"view",ref:"osc"},m.a.createElement(ue,{data:r,xCount:100}))),m.a.createElement("div",{className:"tool-btns"},m.a.createElement(Y,{onClick:this.run,title:"运行/停止"},m.a.createElement("i",{className:"iconfont icon-".concat(this.interval?"pause":"play")})),m.a.createElement(Y,{onClick:this.handleSaveComponent,title:"保存组件"},m.a.createElement("i",{className:"iconfont icon-collapse"})),m.a.createElement(Y,{onClick:this.save,title:"保存"},m.a.createElement("i",{className:"iconfont icon-save"})),m.a.createElement(Y,{onClick:this.code,title:"查看代码"},m.a.createElement("i",{className:"iconfont icon-code"})),m.a.createElement(Y,{onClick:this.publish,title:"发布"},m.a.createElement("i",{className:"iconfont icon-publish"})))))}}]),t}(d.Component)),he=function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){var e=this.props.match;return m.a.createElement("div",null,m.a.createElement(v.Switch,null,m.a.createElement(v.Route,{exact:!0,path:e.path,component:H}),m.a.createElement(v.Route,{path:"".concat(e.path,"/:id"),component:fe})))}}]),t}(d.Component);n(49);window.API=r;var de=function(e){function t(e){return o()(this,t),l()(this,p()(t).call(this,e))}return h()(t,e),c()(t,[{key:"render",value:function(){return m.a.createElement(v.HashRouter,null,m.a.createElement(v.Switch,null,m.a.createElement(v.Route,{exact:!0,path:"/",component:A}),m.a.createElement(v.Route,{path:"/project",component:he}),m.a.createElement(v.Redirect,{to:"/"})))}}]),t}(d.Component);y.a.render(m.a.createElement(de,null),document.getElementById("app"))}]);
//# sourceMappingURL=bundle.js.map